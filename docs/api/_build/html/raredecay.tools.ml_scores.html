

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>ml_scores &mdash; Raredecay 2.0.2 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Raredecay 2.0.2 documentation" href="index.html"/>
        <link rel="up" title="tools" href="raredecay.tools.html"/>
        <link rel="next" title="output" href="raredecay.tools.output.html"/>
        <link rel="prev" title="metrics" href="raredecay.tools.metrics.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Raredecay
          

          
          </a>

          
            
            
              <div class="version">
                2.0.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="raredecay.data.html">data</a></li>
<li class="toctree-l1"><a class="reference internal" href="raredecay.ml.html">ml</a></li>
<li class="toctree-l1"><a class="reference internal" href="raredecay.reweight.html">reweight</a></li>
<li class="toctree-l1"><a class="reference internal" href="raredecay.score.html">score</a></li>
<li class="toctree-l1"><a class="reference internal" href="raredecay.stat.html">stat</a></li>
<li class="toctree-l1"><a class="reference internal" href="raredecay.settings.html">settings</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="raredecay.html">DEPREC: Full (legacy) API raredecay</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="raredecay.analysis.html">analysis</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="raredecay.tools.html">tools</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="raredecay.tools.data_storage.html">data_storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="raredecay.tools.data_tools.html">data_tools</a></li>
<li class="toctree-l3"><a class="reference internal" href="raredecay.tools.dev_tool.html">dev_tool</a></li>
<li class="toctree-l3"><a class="reference internal" href="raredecay.tools.estimator.html">estimator</a></li>
<li class="toctree-l3"><a class="reference internal" href="raredecay.tools.metrics.html">metrics</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">ml_scores</a></li>
<li class="toctree-l3"><a class="reference internal" href="raredecay.tools.output.html">output</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="raredecay.config.html">config</a></li>
<li class="toctree-l2"><a class="reference internal" href="raredecay.data.html">data</a></li>
<li class="toctree-l2"><a class="reference internal" href="raredecay.globals_.html">globals</a></li>
<li class="toctree-l2"><a class="reference internal" href="raredecay.meta_config.html">meta_config</a></li>
<li class="toctree-l2"><a class="reference internal" href="raredecay.ml.html">ml</a></li>
<li class="toctree-l2"><a class="reference internal" href="raredecay.reweight.html">reweight</a></li>
<li class="toctree-l2"><a class="reference internal" href="raredecay.score.html">score</a></li>
<li class="toctree-l2"><a class="reference internal" href="raredecay.settings.html">settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="raredecay.stat.html">stat</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Raredecay</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
          <li><a href="raredecay.html">DEPREC: Full (legacy) API raredecay</a> &raquo;</li>
      
          <li><a href="raredecay.tools.html">tools</a> &raquo;</li>
      
    <li>ml_scores</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/raredecay.tools.ml_scores.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-raredecay.tools.ml_scores">
<span id="ml-scores"></span><h1>ml_scores<a class="headerlink" href="#module-raredecay.tools.ml_scores" title="Permalink to this headline">¶</a></h1>
<p>DEPRECEATED! USE OTHER MODULES LIKE rd.data, rd.ml, rd.reweight, rd.score and rd.stat</p>
<p>DEPRECEATED!DEPRECEATED!DEPRECEATED!DEPRECEATED!DEPRECEATED!</p>
<dl class="function">
<dt id="raredecay.tools.ml_scores.estimate_weights_bias">
<code class="descclassname">raredecay.tools.ml_scores.</code><code class="descname">estimate_weights_bias</code><span class="sig-paren">(</span><em>mc</em>, <em>real</em>, <em>columns=None</em>, <em>n_folds=10</em>, <em>clf='xgb'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/raredecay/tools/ml_scores.html#estimate_weights_bias"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#raredecay.tools.ml_scores.estimate_weights_bias" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="raredecay.tools.ml_scores.mayou_score">
<code class="descclassname">raredecay.tools.ml_scores.</code><code class="descname">mayou_score</code><span class="sig-paren">(</span><em>mc_data</em>, <em>real_data</em>, <em>features=None</em>, <em>old_mc_weights=1</em>, <em>clf='xgb'</em>, <em>splits=2</em>, <em>n_folds=10</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/raredecay/tools/ml_scores.html#mayou_score"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#raredecay.tools.ml_scores.mayou_score" title="Permalink to this definition">¶</a></dt>
<dd><p>An experimental score using a &#8220;loss&#8221; function for data-similarity</p>
</dd></dl>

<dl class="function">
<dt id="raredecay.tools.ml_scores.similar_dist">
<code class="descclassname">raredecay.tools.ml_scores.</code><code class="descname">similar_dist</code><span class="sig-paren">(</span><em>predictions</em>, <em>weights=None</em>, <em>true_y=1</em>, <em>threshold=0.5</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/raredecay/tools/ml_scores.html#similar_dist"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#raredecay.tools.ml_scores.similar_dist" title="Permalink to this definition">¶</a></dt>
<dd><p>Metric to evaluate the predictions on one label only for similarity test.</p>
<p>This metric is used inside the mayou_score</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>predictions</strong> (<code class="xref py py-class docutils literal"><span class="pre">array</span></code>) &#8211; The predicitons</li>
<li><strong>weights</strong> (<em>array-like</em>) &#8211; The weights for the predictions</li>
<li><strong>true_y</strong> (<em>{0</em><em> , </em><em>1}</em>) &#8211; The &#8220;true&#8221; label of the data</li>
<li><strong>threshold</strong> (<a class="reference external" href="https://docs.python.org/2/library/functions.html#float" title="(in Python v2.7)"><em>float</em></a>) &#8211; The threshold for the predictions to decide whether a point belongs
to 0 or 1.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="raredecay.tools.ml_scores.train_similar">
<code class="descclassname">raredecay.tools.ml_scores.</code><code class="descname">train_similar</code><span class="sig-paren">(</span><em>mc_data</em>, <em>real_data</em>, <em>features=None</em>, <em>n_checks=10</em>, <em>n_folds=10</em>, <em>clf='xgb'</em>, <em>test_max=True</em>, <em>test_shuffle=True</em>, <em>test_mc=False</em>, <em>old_mc_weights=1</em>, <em>test_predictions=False</em>, <em>clf_pred='rdf'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/raredecay/tools/ml_scores.html#train_similar"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#raredecay.tools.ml_scores.train_similar" title="Permalink to this definition">¶</a></dt>
<dd><p>Score for reweighting. Train clf on mc reweighted/real, test on real; minimize score.</p>
<p>Enter two datasets and evaluate the score described below. Return a
dictionary containing the different scores. The test_predictions is
another scoring, which is built upon the train_similar method.</p>
<p><strong>Scoring method description</strong></p>
<p><strong>Idea</strong>:
A clf is trained on the reweighted mc as well as on the real data of a
certain decay. Therefore, the classifier learns to distinguish between
Monte-Carlo data and real data. Then we let the classifier predict some
real data (an unbiased test set) and see, how many he is able to classify
as real events. The lower the score, the less differences he was able to
learn from the train data therefore the more similar the train data
therefore the better the reweighting.</p>
<p><strong>Advandages</strong>: It is quite difficult to cheat on this method. Most of all
it is robust to single high-weight events (which mcreweighted_as_real is
not) and, in general, seems to be the best scoring so far.</p>
<p><strong>Disadvantages</strong>: If you insert a gaussian shaped 1.0 as mc and a gaussian
shaped 1.1 as real, the score will be badly (around 0.33). So far, this was
only observed for &#8220;artificial&#8221; distributions (even dough, of course, we
do not know if it affects real distributions aswell partly)</p>
<p><strong>Output explanation</strong></p>
<p>The return is a dictionary containing several values. Of course, only the
values, which are set to be evaluated, are contained. The keys are:</p>
<ul class="simple">
<li>&#8216;<strong>score</strong>&#8216; : The average of all train_similar scores (as we use KFolding,
there will be n_folds scores). <em>The</em> score.</li>
<li>&#8216;<strong>score_std</strong>&#8216; : The std of a single score, just for curiosity</li>
<li>&#8216;<strong>score_max</strong>&#8216; : The (average of all) &#8220;maximum&#8221; score. Actually the
train_similar score but
with mc instead of <em>reweighted</em> mc. Should be higher then the
reweighted score.</li>
<li>&#8216;<strong>score_max_std</strong>&#8216; : The std of a single score, just for curiosity</li>
<li>&#8216;<strong>score_pred</strong>&#8216; : The score of the test_predictions method.</li>
<li>&#8216;<strong>score_mc_pred</strong>&#8216; : The score of the test_predictions method but on the
predictions of the mc instead of the <em>reweighted</em> mc.</li>
</ul>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>mc_data</strong> (<a class="reference internal" href="raredecay.data.html#raredecay.data.HEPDataStorage" title="raredecay.data.HEPDataStorage"><code class="xref py py-class docutils literal"><span class="pre">HEPDataStorage</span></code></a>) &#8211; The reweighted Monte-Carlo data, assuming the new weights are applied
already.</li>
<li><strong>real_data</strong> (<a class="reference internal" href="raredecay.data.html#raredecay.data.HEPDataStorage" title="raredecay.data.HEPDataStorage"><code class="xref py py-class docutils literal"><span class="pre">HEPDataStorage</span></code></a>) &#8211; The real data</li>
<li><strong>n_checks</strong> (<em>int &gt;= 1</em>) &#8211; Number of checks to perform. Has to be &lt;= n_folds</li>
<li><strong>n_folds</strong> (<em>int &gt; 1</em>) &#8211; Number of folds the data will be split into</li>
<li><strong>clf</strong> (<a class="reference external" href="https://docs.python.org/2/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) &#8211; The name of a classifier to be used in
<a class="reference internal" href="raredecay.analysis.ml_analysis.html#raredecay.analysis.ml_analysis.classify" title="raredecay.analysis.ml_analysis.classify"><code class="xref py py-func docutils literal"><span class="pre">classify()</span></code></a>.</li>
<li><strong>test_max</strong> (<em>boolean</em>) &#8211; If true, test for the &#8220;maximum value&#8221; by training also on mc/real
(instead of <em>reweighted</em> mc/real)
and test on real. The score for only mc should be higher than for
reweighted mc/real. It <em>should</em> most probably but does not have to
be!</li>
<li><strong>old_mc_weights</strong> (<em>array-like</em><em> or </em><em>1</em>) &#8211; If <em>test_max</em> is True, the weights for mc before reweighting will be
taken to be <em>old_mc_weights</em>, the weights the mc distribution had
before the reweighting. The default is 1.</li>
<li><strong>test_predictions</strong> (<em>boolean</em>) &#8211; If true, try to distinguish the predictions. Advanced feature and not
yet really discoverd how to interpret. Gives very high ROC somehow.</li>
<li><strong>clf_pred</strong> (<a class="reference external" href="https://docs.python.org/2/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) &#8211; The classifier to be used to distinguish the predictions. Required for
the <em>test_predictions</em>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>out</strong> &#8211; A dictionary conaining the different scores. Description see above.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last"><a class="reference external" href="https://docs.python.org/2/library/stdtypes.html#dict" title="(in Python v2.7)">dict</a></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="raredecay.tools.ml_scores.train_similar_new">
<code class="descclassname">raredecay.tools.ml_scores.</code><code class="descname">train_similar_new</code><span class="sig-paren">(</span><em>mc</em>, <em>real</em>, <em>columns=None</em>, <em>n_checks=10</em>, <em>n_folds=10</em>, <em>clf='xgb'</em>, <em>test_max=True</em>, <em>test_shuffle=True</em>, <em>test_mc=False</em>, <em>old_mc_weights=1</em>, <em>test_predictions=False</em>, <em>clf_pred='rdf'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/raredecay/tools/ml_scores.html#train_similar_new"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#raredecay.tools.ml_scores.train_similar_new" title="Permalink to this definition">¶</a></dt>
<dd><p>Score for reweighting. Train clf on mc reweighted/real, test on real; minimize score.</p>
<p>Enter two datasets and evaluate the score described below. Return a
dictionary containing the different scores. The test_predictions is
another scoring, which is built upon the train_similar method.</p>
<p><strong>Scoring method description</strong></p>
<p><strong>Idea</strong>:
A clf is trained on the reweighted mc as well as on the real data of a
certain decay. Therefore, the classifier learns to distinguish between
Monte-Carlo data and real data. Then we let the classifier predict some
real data (an unbiased test set) and see, how many he is able to classify
as real events. The lower the score, the less differences he was able to
learn from the train data therefore the more similar the train data
therefore the better the reweighting.</p>
<p><strong>Advandages</strong>: It is quite difficult to cheat on this method. Most of all
it is robust to single high-weight events (which mcreweighted_as_real is
not) and, in general, seems to be the best scoring so far.</p>
<p><strong>Disadvantages</strong>: If you insert a gaussian shaped 1.0 as mc and a gaussian
shaped 1.1 as real, the score will be badly (around 0.33). So far, this was
only observed for &#8220;artificial&#8221; distributions (even dough, of course, we
do not know if it affects real distributions aswell partly)</p>
<p><strong>Output explanation</strong></p>
<p>The return is a dictionary containing several values. Of course, only the
values, which are set to be evaluated, are contained. The keys are:</p>
<ul class="simple">
<li>&#8216;<strong>score</strong>&#8216; : The average of all train_similar scores (as we use KFolding,
there will be n_folds scores). <em>The</em> score.</li>
<li>&#8216;<strong>score_std</strong>&#8216; : The std of a single score, just for curiosity</li>
<li>&#8216;<strong>score_max</strong>&#8216; : The (average of all) &#8220;maximum&#8221; score. Actually the
train_similar score but
with mc instead of <em>reweighted</em> mc. Should be higher then the
reweighted score.</li>
<li>&#8216;<strong>score_max_std</strong>&#8216; : The std of a single score, just for curiosity</li>
<li>&#8216;<strong>score_pred</strong>&#8216; : The score of the test_predictions method.</li>
<li>&#8216;<strong>score_mc_pred</strong>&#8216; : The score of the test_predictions method but on the
predictions of the mc instead of the <em>reweighted</em> mc.</li>
</ul>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>mc</strong> (<a class="reference internal" href="raredecay.data.html#raredecay.data.HEPDataStorage" title="raredecay.data.HEPDataStorage"><code class="xref py py-class docutils literal"><span class="pre">HEPDataStorage</span></code></a>) &#8211; The reweighted Monte-Carlo data, assuming the new weights are applied
already.</li>
<li><strong>real</strong> (<a class="reference internal" href="raredecay.data.html#raredecay.data.HEPDataStorage" title="raredecay.data.HEPDataStorage"><code class="xref py py-class docutils literal"><span class="pre">HEPDataStorage</span></code></a>) &#8211; The real data</li>
<li><strong>n_checks</strong> (<em>int &gt;= 1</em>) &#8211; Number of checks to perform. Has to be &lt;= n_folds</li>
<li><strong>n_folds</strong> (<em>int &gt; 1</em>) &#8211; Number of folds the data will be split into</li>
<li><strong>clf</strong> (<a class="reference external" href="https://docs.python.org/2/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) &#8211; The name of a classifier to be used in
<a class="reference internal" href="raredecay.analysis.ml_analysis.html#raredecay.analysis.ml_analysis.classify" title="raredecay.analysis.ml_analysis.classify"><code class="xref py py-func docutils literal"><span class="pre">classify()</span></code></a>.</li>
<li><strong>test_max</strong> (<em>boolean</em>) &#8211; If true, test for the &#8220;maximum value&#8221; by training also on mc/real
(instead of <em>reweighted</em> mc/real)
and test on real. The score for only mc should be higher than for
reweighted mc/real. It <em>should</em> most probably but does not have to
be!</li>
<li><strong>old_mc_weights</strong> (<em>array-like</em><em> or </em><em>1</em>) &#8211; If <em>test_max</em> is True, the weights for mc before reweighting will be
taken to be <em>old_mc_weights</em>, the weights the mc distribution had
before the reweighting. The default is 1.</li>
<li><strong>test_predictions</strong> (<em>boolean</em>) &#8211; If true, try to distinguish the predictions. Advanced feature and not
yet really discoverd how to interpret. Gives very high ROC somehow.</li>
<li><strong>clf_pred</strong> (<a class="reference external" href="https://docs.python.org/2/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) &#8211; The classifier to be used to distinguish the predictions. Required for
the <em>test_predictions</em>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>out</strong> &#8211; A dictionary conaining the different scores. Description see above.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last"><a class="reference external" href="https://docs.python.org/2/library/stdtypes.html#dict" title="(in Python v2.7)">dict</a></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="raredecay.tools.output.html" class="btn btn-neutral float-right" title="output" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="raredecay.tools.metrics.html" class="btn btn-neutral" title="metrics" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Jonas Eschle.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'2.0.2',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>